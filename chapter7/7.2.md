# 7.2 坐标变换TF

### 7.2.1 TF基础

**（1）为什么要做TF**

![](/pics/image034.png)

$$\quad$$机器人系统是由很多坐标系构成，并且每个坐标系都是随着时间变化的，例如：我通过激光雷达扫描到点可以知道laser到障碍物的距离。也就是知道laser到odom的坐标变换，而我们又已知base\_link到laser的坐标变换，通过这上面的两个坐标变换，我们就可以知道从odom到base\_link的坐标变换。

![](/pics/image035.png)

**\(2\)坐标变换Transform**

$$\quad$$ROS tf（transdform）库的目的是为了提供一种标准的手段来跟踪坐标系之间变换。TF为了实现坐标变换设计了相关的数据结构，来描述坐标系之间的转换关系。在tf功能包中的头文件Transform.h中定义Transform类，它用来表示旋转和平移的齐次坐标变换。这个类中的主要数据成员Matrix3x3 m\_basis和Vector3 m\_origin，其中m\_basis表示坐标系之间的旋转关系，用四元数或者欧拉角计算得来，另一个成员变量m\_origin是一个向量，表示从坐标原点到另外一个坐标原点之间的位移位置变换。

CPP版本

| 编号 | 函数名称 | 函数功能 |
| :---: | :---: | :---: |
| 1 | void mult\(const Transform &t1, const Transform &t2\) | 计算t1到t2的迭代变换 |

$$\quad$$利用上面的函数，就可以很轻松的解决如下问题：已知坐标系A到坐标系B之间的变换是transform1以及坐标系B到坐标系C之间的坐标变换是transform2，此时利用mult函数就可以求出A到C之间的变换

$$\qquad \qquad \qquad  \qquad \qquad \qquad Transform3=Transform1*Transform2$$

**少一图**

**\(3\)坐标转换信息的消息类-StampedTransform**

$$\quad$$$$\quad$$在tf功能包中的头文件transform\_datatypes.h中定义了这个类，它是Transform类的一个子类，在Transform的基础上面添加了几个成员变量：

| ros::Time stamp\_ | 本次旋转对应的时间戳 |
| :---: | :---: |
| std::string frame\_id | 本次旋转对对应的父坐标系名称 |
| std::string child\_frame\_id | 本次旋转对应的子坐标系的名称 |

Transform类中重要的成员函数

cpp版本

| 编号 | 函数名称 | 函数功能 |
| :---: | :---: | :---: |
| 1 | bool Transformer::setTransform\(const StampedTransform &transform, const std::string &authority\) | 从指定坐标系上，添加一个新的坐标系 |
| 2 | void lookupTransform\(const std::string &target\_frame, const std::string &source\_frame, const ros::Time &time, StampedTransform &transform\) | 监听给定时刻，从父坐标系到子坐标系之间的坐标变换 |
| 3 | bool waitForTransform\(const std::string &target\_frame, const std::string source\_target, const ros::Duration &timeout\) | 每隔特定时间监听，是否存在父坐标系和子坐标系之间的坐标变换 |



python版本  
	首先需要导入tf功能包，即import tf. Transformer采用的是string类型，平移采用的（x,y,z）旋转采用四元数（x,y,z,w），python中的tuple（元组）来表示

transform类的数据结构如下：



header

 stamp time stamp, rospy.Time

 frame\_id string, parent frame

child\_frame\_id string, child frame

transform

 translation

 x float

 y float

 z float

 rotation

 x float

 y float

 z float

 w float

常用的函数

