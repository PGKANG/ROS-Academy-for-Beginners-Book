# 2.3 package软件包
package是catkin编译的基本单元，编译的对象就是一个个package。任何ROS程序只有在package中才能编译。

### 2.3.1 package结构
一个package下常见的文件、路径有：
```
├── CMakeLists.txt   #package的编译规则
├── package.xml      #package的描述信息
├── src              #源代码文件
├── scripts          #可执行脚本
├── msg              #自定义消息
├── srv              #服务
├── models           #3D模型文件
├── urdf             #urdf文件
├── launch           #launch文件
```

其中定义package的是`CMakeLists.txt`和`package.xml`，这两个文件是package中必不可少的。catkin编译系统在编译前，首先就要解析这两个文件。这两个文件就定义了一个package。

* CMakeLists.txt: 定义package的包名、依赖、源文件、目标文件等编译规则
* package.xml: 描述package的包名、版本号、作者、依赖等信息
* src/: 存放ROS的源代码，包括C++的源码和Python的module
* scripts/: 存放可执行脚本，例如shell脚本(.sh)、Python脚本(.py)
* msg/: 存放自定义格式的消息(.msg)
* srv/: 存放自定义格式的服务(.srv)
* models/: 存放机器人或仿真场景的3D模型(.sda, .stl, .dae等)
* urdf/: 存放机器人的模型描述(.urdf或.xacro)
* launch/: 存放launch文件(.launch或.xml)

通常ROS文件组织都是按照以上的形式，这是约定俗成的命名习惯，并不是必须这样，只有`CMakeLists.txt`和`package.xml`必须得有。

### 2.3.1 rospack命令
rospack是对package管理的工具，命令的用法如下：
用法: rospack <command> [options] [package]
  Allowed commands:
    help
    cflags-only-I     [--deps-only] [package]
    cflags-only-other [--deps-only] [package]
    depends           [package] (alias: deps)
    depends-indent    [package] (alias: deps-indent)
    depends-manifests [package] (alias: deps-manifests)
    depends-msgsrv    [package] (alias: deps-msgsrv)
    depends-on        [package]
    depends-on1       [package]
    depends-why --target=<target> [package] (alias: deps-why)
    depends1          [package] (alias: deps1)
    export [--deps-only] --lang=<lang> --attrib=<attrib> [package]
    find [package]
    langs
    libs-only-L     [--deps-only] [package]
    libs-only-l     [--deps-only] [package]
    libs-only-other [--deps-only] [package]
    list
    list-duplicates
    list-names
    plugins --attrib=<attrib> [--top=<toppkg>] [package]
    profile [--length=<length>] [--zombie-only]
    rosdep  [package] (alias: rosdeps)
    rosdep0 [package] (alias: rosdeps0)
    vcs  [package]
    vcs0 [package]
  Extra options:
    -q     Quiets error reports.

 If [package] is omitted, the current working directory
 is used (if it contains a package.xml or manifest.xml).






##### 2. 计算图级
计算图是一种点对点的网络形式，在进程运算过程中将数据处理以点对点的图表现出来。ROS中基本的计算图级概念包括节点、节点管理器、参数服务器、消息、服务、主题、包等。

##### 3. 社区级
ROS为了采用软件仓库形式共每个研究组织和开发者发布自己的代码，鼓励全世界范围内的开发者和用户提供、维护自己的ROS仓库代码，并且他们对自己的代码具有相应的权利。

### 2.2.2 CmakeList写法(百度的，你在用自己的语言改一下)
CMake构建系统通过ROS包中的CMakeList.txt来构建软件包。互相依赖的包都包含一个或者多个CMakeList.txt来描述如何编译代码和如何安装。
##### 1. CmakeList版本
CMakeLists.txt文件必须以CMake的版本开头。下面表示的是Catkin需要2.8.3或更高的版本。如cmake_minimum_required(VERSION 2.8.3)。

##### 2. 软件包名称
继而需要指定CMake工程名，一般取作包名。例如我们的项目名叫做robot_brain，则project(robot_brain)，而在CMake中，可以在CMake文本中使用变量${PROJECT_NAME}来引用项目名称。

##### 3. 查找相关包
接下来我们要用find_package指令来指定在构建项目过程中依赖了哪些其他的包，在ROS中，catkin必备依赖,所以我们写上catkin REQUIRED：find_package(catkin REQUIRED)。在此基础上，如果我们还需要依赖其他包（或者组件），我们就在 上述的包后面继续添加包（组件）名即可：find_package(catkin REQUIRED COMPONENTS nodelet) 或者写成find_package(catkin REQUIRED)/find_package(nodelet REQUIRED)。

##### 4. catkin_package()
catkin_package()是一个catkin提供的CMake宏，用于将catkin特定的信息信息输出到构建系统上，用于生成pkg配置文件以及CMake文件。
这个命令必须在add_library()或者add_executable()之前调用，该函数有5个可选参数：
(1) INCLUDE_DIRS - 导出包的include路径
(2) LIBRARIES - 导出项目中的库
(3) CATKIN_DEPENDS - 该项目依赖的其他catkin项目
(4) DEPENDS - 该项目所依赖的非catkin CMake项目。
(5) CFG_EXTRAS - 其他配置选项

##### 5. 指定构建目标
构建目标可以有多种形式，但通常主要有以下两种：
(1) 执行文件目标 - 可以运行的程序
(2) 库目标 - 可在构建和/或运行时给可执行目标使用的库

##### 6. 消息、服务和响应
消息（.msg），服务（.srv）和响应（.action）文件在ROS包构建和使用之前需要一个特殊的预处理器构建步骤。 这些宏的要点是生成编程语言特定的文件，以便可以利用其选择的编程语言中的消息，服务和动作。 构建系统将使用生成器（例如gencpp，genpy，genlisp等）生成绑定。
提供了三个宏来分别处理消息，服务和响应：
(1) add_message_files
(2) add_service_files
(3) add_action_files
而在之后必须在下面写下面宏，catkin时候会在devel的include文件夹中生成对应的头文件：generate_messages()

##### 7. 启动模块支持
如果catkin包使用一些Python模块，您应该创建一个setup.py文件，并在调用catkin_python_setup（）之前调用generate_messages（）和catkin_package（）。

##### 8. 单位测试
有一个catkin-specific宏用于处理名为catkin_add_gtest（）的基于gtest的单元测试。catkin_add_gtest（myUnitTest test / utest.cpp）。

##### 9. 可选步骤：指定可安装的目标
构建后，构建目标通常被放置在catkin工作区中。但有时候我们希望将目标安装到系统其他地方（有关安装路径的信息可以在REP 122中找到），以便其他人或本地文件夹可以使用它们来测试。换句话说，如果你想要做一个“make install”的代码，你需要指定目标应该生成到哪里。
这是使用CMake install()函数作为参数完成的：
(1) 目标 - 目标是安装
(2) ARCHIVE DESTINATION - 静态库和DLL（Windows）.lib存根
(3) LIBRARY DESTINATION - 非DLL共享库和模块
(4) RUNTIME DESTINATION - 可执行目标和DLL（Windows）样式共享库
除了这些标准目标，一些文件必须安装到特殊文件夹。即一个包含Python绑定的库必须安装到不同的文件夹中才能在Python中导入：
install(TARGETS python_module_library
  ARCHIVE DESTINATION ${CATKIN_PACKAGE_PYTHON_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_PYTHON_DESTINATION}
)

### 2.2.3 package.xml写法
package.xml实际上是一个程序包的描述文件。当你的package里已经包含配置文件(package.xml)，ROS能够找到它。执行：rospack find [包名称]。应该注意到我们刚才所创建的package.xml依赖于 roscpp 和 std_msgs.而catkin恰恰是利用这些依赖项来配置所创建的package。

##### 1. 基本结构
使用<package>标签作为根标记文件。
<package>
</ package>

##### 2. 所需标签
(1) <name> - 包的名称
(2) <version> - 包的版本号（需要3个点分隔的整数）
(3) <description> - 包装内容的描述
(4) <maintainer> - 维护包的人员的名称
(5) <license> - 发布代码的软件许可证（例如GPL，BSD，ASL）。

##### 3. 依赖关系
(1) <buildtool_depend>构建工具依赖关系指定此软件包需要构建自身的构建系统工具。通常唯一的构建工具是catkin。在交叉编译场景中，构建工具依赖关系用于执行编译的架构。
(2) <build_depend>构建依赖关系指定构建此包所需的包。在构建时需要这些软件包中的任何文件时才是这种情况。这可以包括这些包在编译时的标头，链接到这些包的库或在构建时需要任何其他资源（特别是当这些包在CMake 中是find_package（））时）。在交叉编译场景中，构建依赖关系针对目标体系结构。
(3) <run_depend>运行依赖关系指定在此程序包中运行代码所需的软件包，或针对此软件包构建库。在这种情况下，您依赖于共享库或将其头部包含在此包中的公头中（特别是当这些包在CMake 中的catkin_package（）中声明为（CATKIN_DEPENDS）时）。

### 2.2.4 命令介绍
##### 1. ROS文件系统命令
(1) rospack是用于从文件系统中提取功能包信息的命令工具，用于执行很多打印功能包信息的命令，其用法 rospack <command> [options] [package]
(2) rosstack是用于从文件系统中提取功能包信息集的命令工具，用于执行一系列与功能包集信息的命令，其用法 rosstack [options] <command> [stack]
(3) roscd是用于改变路径到相应的功能包或者功能包集的命令工具，其用法 roscd [package[/subdir]]
(4) rosls是用于罗列相应的功能包、功能包集文件夹的命令包，其用法 rosls [package[/subdir]]
(5) roscreate-pkg是用于创建新的功能包，其用法 roscreate-pkg [package_name] 或者 roscreate-pkg [package_name] [depend1] [depend2] [depend3]
(6) roscreate-stack是用于创建一个新的ROS功能包集，其用法类似roscreat-pkg
(7) rosdep是用于安装ROS功能包系统依赖文件
(8) rosmake是用于编译安装一个ROS功能包，其用法 rosmake [[package] 或者 编译多个 rosmake [package1] [package2] [package3]
(9) roswtf是用于显示ROS系统或者启动文件的错误或者警告信息
(10) rosdep是用于显示功能包结构和依赖文件信息，其用法 rosdep [options]

##### 2. ROS核心命令
(1) roscore是用于运行基于ROS系统必须的节点和程序的集合。至少要有一个roscore在运行才能保证节点能够正常通信。
(2) rosmsg/rossrv是用于显示消息或者服务的结构定义。
(3) rosrun是用于不必改变到相应目录就可以执行任意一个功能包下的可执行文件，其用法 rosrun package executable。
(4) rosnode是用于显示关于ROS节点的调试信息。
(5) roslaunch是用于通过SSH和在参数服务器上设置参数来局部和远程启动ROS节点。通过调用一个或者多个XML配置文件来完成启动过程。
(6) rostopic是用于显示ROS主题调试信息的工具。
(7) rosparam是用于获取和设置参数服务器上用YAML编码的文件的工具。
(8) rosservice是用于列表和查询ROS服务器的工具。
