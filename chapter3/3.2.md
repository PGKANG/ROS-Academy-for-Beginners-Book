
# 3.2 Topic && Message

ROS的通信方式是ROS最为核心的概念，上面我们介绍了节点的概念，在应用中各个节点之间的通信使得整个ROS得以运转，可以说通信方式是ROS的灵魂。ROS的通信方式有以下四种：

* Topic 主题
* Service 服务
* Parameter Service 参数服务器
* Actionlib 动作库

### 3.2.1 topic
ROS中的通信方式，topic是最常用的一种。我们结合上节课所讲的节点和节点管理器，来理解topic可能会更加容易。

![](https://i.loli.net/2017/11/02/59fb1ec5ad3ab.png)


上图就是ROS的topic通信方式的一个结构图，topic通信属于一种异步的通信方式。ROS中所谓的异步通信方式，是指两个node之间进行通信，并非一对一同步进行。通常先定义好一个共同的话题，然后通过Publish-subscribe机制通信，详细解读这种通信机制，我们来分析下面的例子。

#### 通信示例
参考上图，摄像头camera的一个程序可以看成node1。当程序运行启动了这个node1之后，它作为一个Publisher就开始发布topic。比如它发布了两个topic，第一个是`/camera-rgb`就是rgb的颜色信息，也即是采集到的图像。第二个是`/camera-depth`就是具有深度传感器的摄像头发布的深度信息。那么怎么样来理解**“异步”**这个概念呢？依例，就是在node1发布这两个topic之后，它的任务也就告一段落，至于消息是什么状态，node1不需要了解或处理，也就是node1不需要等待消息的状态反馈，只需完成自己的publish就可以。于此同时，node2假如是图像处理程序——image process,它在节点管理器订阅了`/camera-rgb`和`/camera-depth`这两个topic，那么只要是master提供了订阅的topic消息，那么它就接受然后处理，而不需要知道是哪个节点发布的。发送和接受不是同步进行，所以称之为异步通信方式。

**总结两点**： 

1. topic通信方式是异步的，发送时调用publish()方法，发送完成立即返回，不用等待反馈。
2. topic可以同时被多个node订阅，同时，同一个topic可以有多个publishers。例如：/rosout、/tf等等。

### 3.2.2 Message
#### Message的构成
topic有很严格的格式要求，比如上面的摄像头中的rgb图像topic，那么它就必然要遵循ROS中定义好的rgb图像格式。这种数据格式就是Message。Message按照定义来解释就是topic内容的数据类型，也称之为topic的格式标准。和我们平常用到的Massage概念有所不同，这里的Message不单单指一条发布或者订阅的消息，也指定为topic的格式标准。

基本的msg包括bool、int8、int16、int32、int64(以及uint)、float、float64、string、time、duration、header、可变长数组array[]、固定长度数组array[C]。那么具体的一个msg是怎么组成的呢？我们用一个具体的msg来了解，例如上例中的msg `sensor_msg/image`,位置存放在`sensor_msgs/msg/image.msg`里,它的结构如下：

	std_msg/Header header
		uint32	seq
		time	stamp
		string	frame_id
	uint32	height
	uint32	width
	string	encoding
	uint8	is_bigendian
	uint32	step
	uint8[]	data

观察上面msg的定义，是不是很类似C语言中的结构体呢？通过具体的定义图像的宽度，高度等等来规范图像的格式。所以这就解释了Message不仅仅是我们平时理解的一条一条的消息，而且更是ROS中topic的格式规范。或者可以理解msg是一个“类”，那么我们每次发布的内容可以理解为“对象”，这么对比来理解可能更加容易。

### 3.2.3 topic&&msg命令
在实际应用中，我们应该熟悉topic和msg的使用命令，下表详细的列出了各自的命令及其作用。

|    rostopic命令    | 作用 |
| :------:   | :------:           |
| `rostopic list`               |   列出当前所有的topic |
| `rostopic info [topic_name]`   |  显示某个topic的属性信息  |
| `rostopic echo [topic_name]`   |  显示某个topic的内容 |
| `rostopic pub [topic_name ...] `    |  向某个topic发布内容|

而rosmsg得命令就比较少了，只有两个如下：

|    rosmsg命令    | 作用 |
| :------:   | :------:           |
| `rosmsg list`               |   列出系统上所有的msg |
| `rosmsg show [msg_name]`   |  显示某个msg的内容  |

#####小结
学习完topic通信方式的基本概念和使用的命令，我们最好上手去做一做，参考我们课程的教学视频，去亲自试一试topic的各种命令，在实践中增长自己对ROS通信方式的认识。